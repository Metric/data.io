var events=require("events"),async=require("async"),Socket=function(){this.ws=null,this.init.apply(this,arguments)};Socket.prototype=Object.create(events.EventEmitter.prototype),Socket.prototype.connected=function(){return this.ws?this.ws.readyState==this.ws.OPEN:!1},Socket.prototype.init=function(t){var e=this;return this.ws=t,this.ws&&(this.ws.on("message",function(t){e._handleMessage(t)}),this.ws.on("close",function(){e._broadcast("close")}),this.ws.on("error",function(t){e._broadcast("error",t)})),this},Socket.prototype._handleMessage=function(t){var e=JSON.parse(t);return e.name&&"string"==typeof e.name&&e.data&&Array.isArray(e.data)?this._broadcast(e.name,e.data):this._broadcast("error",new Error("Invalid Packet Received: "+t)),this},Socket.prototype._broadcast=function(t,e){var r=[t];return r=r.concat(e),this._emit.apply(this,r),this},Socket.prototype.close=function(){return this.ws&&this.ws.close(),this},Socket.prototype._emit=Socket.prototype.emit,Socket.prototype.emit=function(t){var e=this,r=[];arguments.length>1&&(r=Array.prototype.slice.call(arguments,1,arguments.length));var s={name:t,data:r};return this.connected()&&this.ws.send(JSON.stringify(s),function(t){t&&e._broadcast("error",t)}),this},module.exports=exports=Socket;